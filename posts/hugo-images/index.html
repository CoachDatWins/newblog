<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">

<title>
    
    Controlling Images with tags in Hugo | Francesco Tomaselli
    
</title>



<link rel="stylesheet" href="/assets/combined.min.7ce286d9b2c89446b93ce394054fc0ae0b16b4fa019c549393df45637813c3db.css" media="all">




  



  </head>

  

  
  
  

  <body class="auto">

    <div class="content">
      <header>
        

<div class="header">
    <h1 class="header-title">Francesco Tomaselli</h1>

    <div class="flex">
        

        
        
        <p class="small ">
            <a href="/">
                /home
            </a>
        </p>
        
        <p class="small ">
            <a href="/posts">
                /posts
            </a>
        </p>
        
        <p class="small ">
            <a href="/about">
                /about
            </a>
        </p>
        
        
    </div>

</div>
      </header>

      <main class="main">
        




<div class="breadcrumbs">
    
    <a href="/">Home</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a href="/posts/">Posts</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a class="breadcrumbs-current" href="/posts/hugo-images/">Controlling Images with tags in Hugo</a>
</div>


<div  class="autonumber" >

  <div class="single-intro-container">

    

    <h1 class="single-title">Controlling Images with tags in Hugo</h1>
    
    <p class="single-summary">Auto-switch images based on theme and specify sizing.</p>
    

    

    <p class="single-readtime">
      
      
      
      <time datetime="2024-05-20T00:00:00&#43;00:00">May 20, 2024</time>
      

      
      &nbsp; · &nbsp;
      2 min read
      
    </p>

  </div>

  

  

  
  <aside class="toc">
    <p><strong>Table of contents</strong></p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#the-problem">The Problem</a></li>
    <li><a href="#solution">Solution</a></li>
    <li><a href="#code">Code</a></li>
  </ul>
</nav>
  </aside>
  

  

  <div class="single-content">
    <h2 id="the-problem">The Problem</h2>
<p>During the writing of my first blog post, I found a problem with images. The drawings I made are png with a transparent background, and, since the lines are black, they look horrible on dark mode, as you can see below.</p>
<p>










<figure class="">

    <div>
        <img loading="lazy" alt="img" src=" problem.webp">
    </div>

    
    <div class="caption-container">
        <figcaption> PNGs on light and dark mode </figcaption>
    </div>
    
</figure></p>
<p>I wanted a quick way to define light and dark mode images for Hugo. Also, controlling image size easily would be great too.</p>
<h2 id="solution">Solution</h2>
<p>GitHub lets users specify in which theme they want readme images with two tags:</p>
<pre tabindex="0"><code>![img](./dark.png#gh-dark-mode-only)
![img](./light.png#gh-light-mode-only)
</code></pre><p>I decided to do something similar, definining several tags, <code>#dark</code>, <code>#light</code>, <code>#small</code>, <code>#full</code>, which controls on which theme an image appears, as well as sizing.</p>
<pre tabindex="0"><code>![img](./dark.png#dark#small)
![img](./light.png#light#full)
</code></pre><p>What’s left is to tweak the hugo image render function to accomplish this.</p>
<h2 id="code">Code</h2>
<p>Hugo renders images with the logic defined in:</p>
<pre tabindex="0"><code>/layouts/_default/_markup/render-image.html
</code></pre><p>We can override it and decide which class to apply to an image based on image tags.
The below code first extracts the tags form the url, if any, and then applies classes to the figure based on them.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>{{/* Split URL at # */}}
</span></span><span style="display:flex;"><span>{{ $url := .Destination | safeURL }}
</span></span><span style="display:flex;"><span>{{ $file_name_array := split $url &#34;#&#34; }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{/*
</span></span><span style="display:flex;"><span>Iterate over all tags, which are in pos 1 to len array - 1,
</span></span><span style="display:flex;"><span>and build the img class string as &#34;img-tag1 img-tag2 ...&#34;
</span></span><span style="display:flex;"><span>*/}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{ $classes := &#34;&#34; }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{ range $idx := seq (sub (len $file_name_array) 1) }}
</span></span><span style="display:flex;"><span>{{ $tag := index $file_name_array $idx }}
</span></span><span style="display:flex;"><span>{{ $classes = printf &#34;%s img-%s&#34; $classes $tag}}
</span></span><span style="display:flex;"><span>{{ end }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{/* Use the computed classes on the rendered figure */}}
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">figure</span> class=<span style="font-style:italic">&#34;{{ $classes }}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="font-weight:bold">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="font-weight:bold">img</span> loading=<span style="font-style:italic">&#34;lazy&#34;</span> alt=<span style="font-style:italic">&#34;{{ .Text }}&#34;</span> src=<span style="font-style:italic">&#34; {{ $url }}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="font-weight:bold">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">figure</span>&gt;
</span></span></code></pre></div><p>Finally, we need to define image classes in our CSS as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>.<span style="font-weight:bold">dark</span> .<span style="font-weight:bold">img-light</span> {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">display</span>: <span style="font-weight:bold">none</span> <span style="">!important</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.<span style="font-weight:bold">light</span> .<span style="font-weight:bold">img-dark</span> {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">display</span>: <span style="font-weight:bold">none</span> <span style="">!important</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.<span style="font-weight:bold">img-small</span> <span style="font-weight:bold">div</span> {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">display</span>: <span style="font-weight:bold">flex</span>;
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">align-items</span>: <span style="font-weight:bold">center</span>;
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">justify-content</span>: <span style="font-weight:bold">center</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.<span style="font-weight:bold">img-small</span> <span style="font-weight:bold">img</span> {
</span></span><span style="display:flex;"><span>  scale: 80<span style="">%</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.<span style="font-weight:bold">img-full</span> <span style="font-weight:bold">div</span> {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">display</span>: <span style="font-weight:bold">flex</span>;
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">align-items</span>: <span style="font-weight:bold">center</span>;
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">justify-content</span>: <span style="font-weight:bold">center</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.<span style="font-weight:bold">img-full</span> <span style="font-weight:bold">img</span> {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">width</span>: 100<span style="">vw</span> <span style="">!important</span>;
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">max-width</span>: 100<span style="">vw</span> <span style="">!important</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Where dark and light classes define color schemes and are added dynamically to the body.</p>
<p>This solution is currently implemented in the <a href="https://github.com/tomfran/typo">Typo theme</a>, which is in use on this website, go have a look!</p>
<p>I hope this was useful, thank you for reading!</p>

    
  </div>

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


      </main>
    </div>

    <footer>
      <p>Powered by
    <a href="https://gohugo.io/">Hugo</a>
    and
    <a href="https://github.com/tomfran/typo">tomfran/typo</a>
</p>


    </footer>

  </body>

  <script>

  function isAuto() {
    return document.body.classList.contains("auto");
  }

  function setTheme() {
    if (!isAuto()) {
      return
    }

    document.body.classList.remove("auto");
    let cls = "light";
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      cls = "dark";
    }

    document.body.classList.add(cls);
  }

  function invertBody() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
  }

  if (isAuto()) {
    window.matchMedia('(prefers-color-scheme: dark)').addListener(invertBody);
  }

  setTheme();

</script>

</html>